# CS209A Assignment 2 - TODO List

## âœ… å·²å®Œæˆ
- [x] å•äººç‰ˆæœ¬ï¼šç§æ¤ â†’ ç”Ÿé•¿ â†’ æ”¶è·
- [x] ç½‘ç»œè¿æ¥ï¼šå®¢æˆ·ç«¯-æœåŠ¡å™¨çŠ¶æ€åŒæ­¥
- [x] åŸºç¡€ GUI å’Œç©å®¶åˆ—è¡¨æ˜¾ç¤º
- [x] Server ç»Ÿä¸€è®¡æ—¶å™¨ç®¡ç†ä½œç‰©ç”Ÿé•¿

---

## ğŸ¯ ç¬¬ä¸€ä¼˜å…ˆçº§ï¼šå¤šç”¨æˆ·æ ¸å¿ƒåŠŸèƒ½ (50åˆ†)

### 1. Visit Friends åŠŸèƒ½ â­â­â­â­â­
**ç›®æ ‡**: å…è®¸ç©å®¶æŸ¥çœ‹å¹¶æ“ä½œå…¶ä»–ç©å®¶çš„å†œåœº

- [ ] **Server ç«¯**
  - [ ] æ·»åŠ  `viewers` æ˜ å°„: `Map<String, Set<ClientHandler>>` (è°åœ¨çœ‹è°çš„å†œåœº)
  - [ ] å®ç° `handleVisit(ClientHandler visitor, String targetId)` æ–¹æ³•
    - ä»æ—§çš„è§‚å¯Ÿè€…åˆ—è¡¨ä¸­ç§»é™¤è®¿é—®è€…
    - æ·»åŠ åˆ°æ–°çš„è§‚å¯Ÿè€…åˆ—è¡¨
    - æ›´æ–°è®¿é—®è€…çš„ `viewingId`
  - [ ] ä¿®æ”¹ `notifyFarmViewers(String ownerId)` é€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè¯¥å†œåœºçš„å®¢æˆ·ç«¯

- [ ] **ClientHandler ç«¯**
  - [ ] æ·»åŠ  `viewingId` å­—æ®µ (å½“å‰æ­£åœ¨æŸ¥çœ‹çš„å†œåœºID)
  - [ ] åœ¨ `run()` æ–¹æ³•ä¸­æ·»åŠ  `"visit"` å‘½ä»¤å¤„ç†
  - [ ] å®ç° `handleVisit(Map<String,Object> req)` æ–¹æ³•
  - [ ] ä¿®æ”¹æ¨é€é€»è¾‘: æ¨é€å½“å‰ `viewingId` å¯¹åº”çš„å†œåœºçŠ¶æ€

- [ ] **GameClient ç«¯**
  - [ ] æ·»åŠ  `visit(String targetId)` æ–¹æ³•
  - [ ] å‘é€ `{"op":"visit", "targetId":"Player2"}` åˆ°æœåŠ¡å™¨

- [ ] **CSController ç«¯**
  - [ ] ä¿®æ”¹ `updatePlayersList()`: ç‚¹å‡»ç©å®¶æŒ‰é’®è°ƒç”¨ `client.visit(player)`
  - [ ] æ·»åŠ  "Back to My Farm" æŒ‰é’®
  - [ ] æ ¹æ®å½“å‰æŸ¥çœ‹çš„å†œåœº ID ç¦ç”¨/å¯ç”¨æ“ä½œæŒ‰é’®

---

### 2. Steal åŠŸèƒ½ (å¤šçº¿ç¨‹ç«äº‰æ ¸å¿ƒ) â­â­â­â­â­
**ç›®æ ‡**: å®ç°åŸå­åŒ–çš„å·å–æ“ä½œï¼Œé˜²æ­¢è¶…é¢å·å–

- [ ] **Farm ç±»æ”¹é€ **
  - [ ] æ·»åŠ  `plotYield` å­—æ®µ: `Map<String, Integer>` (å­˜å‚¨æ¯ä¸ªåœ°å—çš„å‰©ä½™æ”¶ç›Š)
  - [ ] ä¿®æ”¹ `plant()`: ç§æ¤æ—¶è®°å½•åˆå§‹æ”¶ç›Š `plotYield.put("row,col", HARVEST_REWARD)`
  - [ ] ä¿®æ”¹ `harvest()`: æ”¶è·æ—¶ä½¿ç”¨ `plotYield` çš„å€¼å¹¶æ¸…ç©ºè®°å½•
  - [ ] å®ç° `steal(int row, int col, String thiefId)` æ–¹æ³•
    - æ£€æŸ¥ä½œç‰©æ˜¯å¦ RIPE
    - è®¡ç®—å¯å·å–æ•°é‡ (å½“å‰æ”¶ç›Šçš„ 25%)
    - åŸå­æ›´æ–°: `plotYield.put(key, currentYield - stealAmount)`
    - è¿”å› `StealResult(success, message, amount)`
  - [ ] åˆ›å»º `StealResult` record ç±»
  - [ ] æ·»åŠ  `addCoins(int amount)` è¾…åŠ©æ–¹æ³•

- [ ] **Server ç«¯**
  - [ ] å®ç° `handleSteal(String thiefId, String victimId, int row, int col)` æ–¹æ³•
    - æ£€æŸ¥å†œåœºä¸»æ˜¯å¦åœ¨å®¶: `victimId.equals(victim.getViewingId())`
    - è°ƒç”¨ `victimFarm.steal()`
    - å¦‚æœæˆåŠŸï¼Œç»™å°å·åŠ å¸: `thiefFarm.addCoins(result.amount())`
    - é€šçŸ¥åŒæ–¹è§‚å¯Ÿè€…: `notifyFarmViewers(victimId)` å’Œ `notifyFarmViewers(thiefId)`
  - [ ] åˆ›å»º `StealResponse` record ç±»

- [ ] **ClientHandler ç«¯**
  - [ ] åœ¨ `run()` æ–¹æ³•ä¸­æ·»åŠ  `"steal"` å‘½ä»¤å¤„ç†
  - [ ] å®ç° `handleSteal(Map<String,Object> req)` æ–¹æ³•
    - è§£æ `targetId`, `row`, `col`
    - è°ƒç”¨ `server.handleSteal(playerId, targetId, row, col)`
    - è¿”å›ç»“æœç»™å®¢æˆ·ç«¯

- [ ] **GameClient ç«¯**
  - [ ] æ·»åŠ  `steal(String targetId, int row, int col)` æ–¹æ³•
  - [ ] å‘é€ `{"op":"steal", "targetId":"Player3", "row":0, "col":1}` åˆ°æœåŠ¡å™¨

- [ ] **CSController ç«¯**
  - [ ] å®ç° `handleSteal()` æ–¹æ³•
    - æ£€æŸ¥æ˜¯å¦é€‰ä¸­åœ°å—
    - æ£€æŸ¥æ˜¯å¦åœ¨è®¿é—®åˆ«äººçš„å†œåœº
    - è°ƒç”¨ `client.steal(currentViewingId, selectedRow, selectedCol)`
  - [ ] ç§»é™¤ "Singleplayer: steal disabled." æç¤º

---

### 3. å¹¶å‘å‹åŠ›æµ‹è¯• â­â­â­â­
**ç›®æ ‡**: éªŒè¯å¤šä¸ªå°å·åŒæ—¶å·å–æ—¶çš„çº¿ç¨‹å®‰å…¨æ€§

- [ ] **åˆ›å»ºæµ‹è¯•ç±» `ConcurrentStealTest.java`**
  - [ ] è¿æ¥ 3 ä¸ªå®¢æˆ·ç«¯
  - [ ] Client3 ç§æ¤ä½œç‰©å¹¶ç­‰å¾…æˆç†Ÿ
  - [ ] Client1 å’Œ Client2 ä½¿ç”¨ `CountDownLatch` åŒæ­¥å¯åŠ¨ï¼ŒåŒæ—¶å·å–åŒä¸€åœ°å—
  - [ ] éªŒè¯æœåŠ¡å™¨æ—¥å¿—: æ€»æ”¶ç›ŠæŸå¤± â‰¤ åŸå§‹æ”¶ç›Šï¼Œä¸”ä¸¤ä¸ªå°å·çš„æ”¶ç›Šåˆç†

- [ ] **æ·»åŠ æœåŠ¡å™¨æ—¥å¿—**
  - [ ] åœ¨ `tickAllFarms()` ä¸­æ‰“å°: `"[Growth] X farms updated"`
  - [ ] åœ¨ `handleSteal()` ä¸­æ‰“å°: `"[Steal] {thiefId} stole {amount} from {victimId} at ({row},{col})"`
  - [ ] ä½¿ç”¨çº¿ç¨‹åæ ‡è¯†: `Thread.currentThread().getName()`

---

## ğŸ¯ ç¬¬äºŒä¼˜å…ˆçº§ï¼šGUI ä¼˜åŒ– (10åˆ†)

### 4. å¢å¼ºè§†è§‰åé¦ˆ â­â­â­
- [ ] **å›¾æ ‡å’Œé¢œè‰²**
  - [ ] ä¸º EMPTY/GROWING/RIPE æ·»åŠ  Emoji å›¾æ ‡: ğŸŒ±/ğŸŒ¿/ğŸŒ¾
  - [ ] åœ¨ CSS ä¸­ä¸ºä¸åŒçŠ¶æ€æ·»åŠ æ¸å˜è‰²èƒŒæ™¯

- [ ] **Toast é€šçŸ¥ç³»ç»Ÿ**
  - [ ] åˆ›å»º `showToast(String message)` æ–¹æ³•
  - [ ] åœ¨å…³é”®äº‹ä»¶æ˜¾ç¤ºé€šçŸ¥: "Crop matured!", "Stolen by Player2!", "Harvest success!"
  - [ ] å®ç°è‡ªåŠ¨æ·¡å‡ºåŠ¨ç”» (3ç§’åæ¶ˆå¤±)

- [ ] **æŒ‰é’®çŠ¶æ€ç®¡ç†**
  - [ ] Plant æŒ‰é’®: åªåœ¨é€‰ä¸­ EMPTY åœ°å—æ—¶å¯ç”¨
  - [ ] Harvest æŒ‰é’®: åªåœ¨é€‰ä¸­ RIPE åœ°å—ä¸”æ˜¯è‡ªå·±å†œåœºæ—¶å¯ç”¨
  - [ ] Steal æŒ‰é’®: åªåœ¨è®¿é—®åˆ«äººå†œåœºä¸”é€‰ä¸­ RIPE åœ°å—æ—¶å¯ç”¨
  - [ ] æ·»åŠ  Tooltip è§£é‡ŠæŒ‰é’®ä¸å¯ç”¨çš„åŸå› 

- [ ] **è®¿é—®æ¨¡å¼æŒ‡ç¤º**
  - [ ] åœ¨ç•Œé¢é¡¶éƒ¨æ˜¾ç¤º: "Viewing: Player2's Farm" æˆ– "My Farm"
  - [ ] æ·»åŠ  "ğŸ  Back to My Farm" æŒ‰é’®

---

## ğŸ¯ ç¬¬ä¸‰ä¼˜å…ˆçº§ï¼šé”™è¯¯å¤„ç† (10åˆ†)

### 5. å¼‚å¸¸å¤„ç†å®Œå–„ â­â­â­
- [ ] **GameClient ç«¯**
  - [ ] å®ç° `reconnect()` æ–¹æ³•: æ–­çº¿åè‡ªåŠ¨é‡è¿ (æœ€å¤š3æ¬¡)
  - [ ] åœ¨ `connect()` ä¸­æ•è· `IOException` å¹¶æç¤ºç”¨æˆ·
  - [ ] æ·»åŠ å¿ƒè·³æ£€æµ‹: å®šæœŸå‘é€ `PING` ä¿æŒè¿æ¥

- [ ] **Server ç«¯**
  - [ ] åœ¨ `ClientHandler.run()` çš„ `finally` ä¸­æ¸…ç†èµ„æº
    - ä» `clients` ä¸­ç§»é™¤
    - ä» `viewers` ä¸­ç§»é™¤æ‰€æœ‰å¼•ç”¨
    - å…³é—­ socket
    - å¹¿æ’­ç©å®¶åˆ—è¡¨æ›´æ–°
  - [ ] æ•è· `tickAllFarms()` ä¸­çš„å¼‚å¸¸ï¼Œé˜²æ­¢å•ä¸ªå†œåœºé”™è¯¯å½±å“å…¨å±€

- [ ] **CSController ç«¯**
  - [ ] éªŒè¯ç”¨æˆ·è¾“å…¥: ä¸èƒ½åœ¨å·²å ç”¨åœ°å—ç§æ¤
  - [ ] æ˜¾ç¤ºå‹å¥½é”™è¯¯ä¿¡æ¯: "Cannot plant on occupied plot"
  - [ ] åœ¨ `shutdown()` ä¸­å®‰å…¨å…³é—­æ‰€æœ‰èµ„æº

---

## ğŸ“š æ–‡æ¡£å’Œæ¼”ç¤ºå‡†å¤‡

### 6. README æ–‡æ¡£ â­â­â­â­
- [ ] **ç¼–å†™ README.md**
  - [ ] é¡¹ç›®ç®€ä»‹å’ŒåŠŸèƒ½åˆ—è¡¨
  - [ ] ç¯å¢ƒè¦æ±‚: JDK 22, JavaFX 22, Maven
  - [ ] å¯åŠ¨æ­¥éª¤
    ```bash
    # å¯åŠ¨æœåŠ¡å™¨
    mvn clean compile exec:java -Dexec.mainClass="org.example.demo.Server"
    
    # å¯åŠ¨å®¢æˆ·ç«¯ (å¤šä¸ªç»ˆç«¯)
    mvn clean javafx:run
    ```
  - [ ] å¹¶å‘è®¾è®¡è¯´æ˜
    - Server ç»Ÿä¸€è®¡æ—¶å™¨çº¿ç¨‹
    - æ¯ä¸ªå®¢æˆ·ç«¯ä¸€ä¸ª Handler çº¿ç¨‹
    - Farm ç±»ä½¿ç”¨ `synchronized` ä¿è¯åŸå­æ“ä½œ
  - [ ] å·²çŸ¥é—®é¢˜å’Œé™åˆ¶

### 7. Demo æ£€æŸ¥æ¸…å• â­â­â­â­â­
- [ ] **5.1 Pre-Demo Preparation**
  - [ ] å¯åŠ¨æœåŠ¡å™¨å¹¶åˆ›å»º3ä¸ªæµ‹è¯•è´¦å·
  - [ ] æ‰“å¼€ç»ˆç«¯æ˜¾ç¤ºæœåŠ¡å™¨æ—¥å¿—
  - [ ] å‡†å¤‡æ¼”ç¤ºè„šæœ¬

- [ ] **5.2 UI Walkthrough**
  - [ ] æ¼”ç¤º Plant â†’ Grow â†’ Harvest æµç¨‹
  - [ ] æŒ‡å‡º 4x4 ç½‘æ ¼ã€é‡‘å¸è®¡æ•°å™¨ã€æ“ä½œæŒ‰é’®ã€çŠ¶æ€åŒºåŸŸ

- [ ] **5.3 Single-Client Robustness**
  - [ ] æ¼”ç¤ºåœ¨å·²å ç”¨åœ°å—ç§æ¤å¤±è´¥
  - [ ] æ¼”ç¤ºé”™è¯¯æ¶ˆæ¯æ˜¾ç¤º

- [ ] **5.4 Multi-Client Visiting**
  - [ ] æ‰“å¼€ä¸¤ä¸ªå®¢æˆ·ç«¯
  - [ ] Client1 è®¿é—® Client2 çš„å†œåœº
  - [ ] éªŒè¯ç•Œé¢åˆ‡æ¢å’ŒåŒæ­¥æ›´æ–°

- [ ] **5.5 Stealing Mechanics**
  - [ ] Client1 åœ¨ Client2 å†œåœºå·å–æˆç†Ÿä½œç‰©
  - [ ] éªŒè¯: Client1 é‡‘å¸å¢åŠ ï¼ŒClient2 æ”¶ç›Šå‡å°‘
  - [ ] éªŒè¯: å½“ Client2 åœ¨è‡ªå·±å†œåœºæ—¶æ— æ³•å·å–

- [ ] **5.6 Concurrent Stealing**
  - [ ] è¿è¡Œ `ConcurrentStealTest`
  - [ ] åœ¨æœåŠ¡å™¨æ—¥å¿—ä¸­å±•ç¤ºå¹¶å‘å¤„ç†
  - [ ] éªŒè¯: ä¸¤ä¸ªå°å·åŒæ—¶å·å–ï¼Œæ”¶ç›Šä¸ä¼šè¶…é¢

---

## ğŸ“… æ—¶é—´è§„åˆ’ (å‡è®¾è¿˜æœ‰ 2 å‘¨)

### Week 1
- **Day 1-2**: Visit Friends åŠŸèƒ½ (Server + Client + GUI)
- **Day 3-4**: Steal åŠŸèƒ½ + åŸå­æ“ä½œ
- **Day 5**: å¹¶å‘æµ‹è¯•è„šæœ¬
- **Day 6-7**: GUI ä¼˜åŒ– (å›¾æ ‡ã€Toastã€æŒ‰é’®çŠ¶æ€)

### Week 2
- **Day 8**: é”™è¯¯å¤„ç†å’Œå¼‚å¸¸æ•è·
- **Day 9**: æ–‡æ¡£ç¼–å†™ (README + ä»£ç æ³¨é‡Š)
- **Day 10-11**: Demo æ¼”ç»ƒå’Œ Bug ä¿®å¤
- **Day 12-13**: ç¼“å†²æ—¶é—´ + æœ€ç»ˆæµ‹è¯•
- **Day 14**: æäº¤å‰æ£€æŸ¥

---

## ğŸ”§ æŠ€æœ¯è¦ç‚¹æé†’

### çº¿ç¨‹å®‰å…¨å…³é”®ç‚¹
1. Farm ç±»çš„æ‰€æœ‰ä¿®æ”¹æ–¹æ³•å¿…é¡» `synchronized`
2. Server çš„ `viewers` å’Œ `clients` ä½¿ç”¨ `ConcurrentHashMap`
3. ClientHandler çš„ `dirty` æ ‡å¿—ä½¿ç”¨ `AtomicBoolean`
4. æ‰€æœ‰ UI æ›´æ–°å¿…é¡»é€šè¿‡ `Platform.runLater()`

### æµ‹è¯•æ£€æŸ¥é¡¹
- [ ] å•äººç§æ¤-æ”¶è·æµç¨‹æ­£å¸¸
- [ ] å¤šäººåŒæ—¶ç§æ¤ä¸åŒåœ°å—æ­£å¸¸
- [ ] è®¿é—®åˆ‡æ¢ç•Œé¢æ­£ç¡®æ˜¾ç¤º
- [ ] å†œåœºä¸»åœ¨å®¶æ—¶æ— æ³•å·å–
- [ ] å†œåœºä¸»ç¦»å¼€åå¯ä»¥å·å–
- [ ] å¤šäººåŒæ—¶å·å–åŒä¸€åœ°å—ä¸ä¼šè¶…é¢
- [ ] å®¢æˆ·ç«¯æ–­çº¿é‡è¿æ­£å¸¸
- [ ] æœåŠ¡å™¨å´©æºƒåå®¢æˆ·ç«¯æ˜¾ç¤ºé”™è¯¯

---

## ğŸ“ æäº¤å‰æ£€æŸ¥
- [ ] ä»£ç ä¸­æ‰€æœ‰ `System.out.println` æ”¹ä¸ºæœ‰æ„ä¹‰çš„æ—¥å¿—æ ¼å¼
- [ ] ç§»é™¤æ‰€æœ‰ debug ä»£ç å’Œæ³¨é‡Š
- [ ] ç¡®ä¿æ‰€æœ‰æ–‡ä»¶æœ‰é€‚å½“çš„ Javadoc æ³¨é‡Š
- [ ] è¿è¡Œ `mvn clean install` ç¡®ä¿ç¼–è¯‘é€šè¿‡
- [ ] æ£€æŸ¥ Git æäº¤å†å²æ˜¯å¦å®Œæ•´
- [ ] å‡†å¤‡æ¼”ç¤º PPT (å¯é€‰)
